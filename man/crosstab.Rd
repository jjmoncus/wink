% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/crosstab.R
\name{crosstab}
\alias{crosstab}
\title{Create Survey Crosstab with Statistical Testing and Design Effects}
\usage{
crosstab(
  data,
  target_var,
  banner_var,
  min_n = 90,
  stat_testing_start = 2,
  design = NULL
)
}
\arguments{
\item{target_var}{A character string specifying the target variable name (the variable
that defines the rows in the crosstab)}

\item{banner_var}{A character string specifying the banner variable name (the variable
that defines the columns in the crosstab)}

\item{min_n}{An integer specifying the minimum unweighted sample size threshold for
banner groups. Groups with fewer observations are excluded from analysis. Default is 90.}

\item{stat_testing_start}{An integer specifying which column letter to start statistical
testing with (1=A, 2=B, etc.). This allows for proper letter assignment when combining
multiple crosstabs. Default is 2 (column B).}

\item{design}{A survey design object (typically from the survey package) containing
the survey data and design specifications}
}
\value{
A data frame containing the formatted crosstab with the following structure:
\itemize{
\item Variable labels row showing the target variable label and banner variable name
\item Column headers showing banner group names
\item Unweighted sample sizes (N) for each banner group
\item Target variable response percentages for each banner group
\item Statistical significance indicators (..) showing which groups differ significantly
\item Design Effect (DEFF) values for each banner group
\item Margin of Sampling Error (MOSE) values for each banner group
}

The returned object has an attribute \code{banner_levels_kept} indicating the number
of banner groups that met the minimum sample size requirement.
}
\description{
This function generates a comprehensive crosstab table for survey data that includes
weighted percentages, statistical significance testing between banner groups, and
survey design statistics (DEFF, MOSE, and unweighted N). Banner groups with
insufficient sample sizes are automatically excluded from analysis.
}
\details{
The function performs several key operations:
\itemize{
\item Filters out cases with missing values in either variable
\item Calculates unweighted N, Design Effect (DEFF), and Margin of Sampling Error (MOSE)
\item Excludes banner groups not meeting the minimum sample size threshold
\item Computes weighted percentages using survey weights
\item Performs pairwise statistical significance testing between banner groups
\item Formats results into a presentation-ready table
}

Statistical testing uses a 95\% confidence level and accounts for survey design effects.
Significant differences are indicated by letters (A, B, C, etc.) showing which groups
a particular group significantly differs from.

DEFF (Design Effect) measures how much the survey design increases variance compared
to simple random sampling. MOSE (Margin of Sampling Error) provides the margin of
error at 95\% confidence assuming a 50/50 split.
}
\note{
\code{banner} and \code{target} variables must be factors. The function expects variable labels to be stored as attributes
(e.g., using the \code{attr(data$variable, "label")} format).

If no banner groups meet the minimum sample size requirement, the function returns
a simple table indicating no levels were kept.
}
\examples{
\dontrun{
# Create a survey design object
library(survey)
library(dplyr)
design <- svydesign(ids = ~1, data = my_survey_data, weights = ~survey_weight)

# Generate a basic crosstab
result <- crosstab(
  design = design,
  target_var = "satisfaction",
  banner_var = "age_group",
  min_n = 100
)

# Check how many banner groups were retained
attr(result, "banner_levels_kept")

# Use in a multi-banner context with custom stat testing start
result2 <- crosstab(
  design = design,
  target_var = "satisfaction",
  banner_var = "region",
  min_n = 50,
  stat_testing_start = 5  # Start at column E
)
}

}
\seealso{
\code{\link[survey]{svydesign}} for creating survey design objects,
\code{\link[survey]{svymean}} for weighted calculations,
}
